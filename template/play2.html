<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>play</title>
    <link rel="stylesheet" href="/assets/style.css" />
  </head>
  <body>
      <header>
        <a href="/" class="header_button home-button">Home</a>
        <a href="https://github.com/khsadira/n-puzzle" class="header_button github-button">View on GitHub</a>
      </header>
  <div class="view-screen">
  <br>
    <div class="puzzle-name">{{.ID}}</div>
    <div class="puzzle"></div>
  <br>
  </div>
</body>

<script>
  function getArray() {
    var array = []
      {{range .Taquin}}
        {{range .}}
        array.push({{.}})
        {{end}}
      {{end}}
      return array
  }


  function printPuzzle(array) {
    var elements = document.getElementsByClassName("puzzle")
    var ul = document.createElement('ul')

    ul.className = "n-puzzle"
    for (var i = 0; i < array.length; i++) {
      var li = document.createElement('li');
      li["data-tile"]=array[i]
      li.innerText = array[i]
      li.onclick = function() {
        moveCase(this["data-tile"])
      }
      ul.appendChild(li)
    }
    elements[0].appendChild(ul)
  }

  function setPuzzleSize() {
    var size = {{.Size}} * 90 + 2
    var elements = document.getElementsByClassName("puzzle");


    for (var i = 0; i < elements.length; i++) {
          elements[i].style.width=(size+"px");
          elements[i].style.height=(size+"px");
    }
  }

  function moveCase(id) {
    console.log("HIHI id", id)
    setClass()
  }

  function setClass() {
    var elements = document.getElementsByClassName("n-puzzle");
    for (var i = 0; i < elements.length; i++) {
      var childs = elements[i].getElementsByTagName('li')
      for (var j = 0; j < childs.length; j++) {
        var correct = j + 1 == childs[j].innerText;
        var cssClass = childs[j].innerText == 0 ? "empty" : (correct ? "correct" : "incorrect");
        childs[j].className=cssClass
      }
    }
  }

  var firstArray = getArray()
  printPuzzle(firstArray)
  setPuzzleSize()
  setClass()

</script>
</html>